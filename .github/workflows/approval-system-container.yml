name:  Docker - Approval System Container

on:
    workflow_dispatch:
        inputs:
            selected_environment:
                type: choice
                description: SELECT ENVIRONMENT
                required: true
                default: test
                options: 
                - prod
                - uat
                - test

env:
    APPSERVICE_NAME: ${{github.event.inputs.selected_environment}}-approval-system-app

defaults:
    run:
        working-directory: src/goapp

jobs:
    build-goapp-container:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - uses: azure/docker-login@v1
              with:
                login-server: ${{ secrets.ACR_REGISTRY }}
                username: ${{ secrets.ACR_USERNAME }}
                password: ${{ secrets.ACR_PASSWORD }}
            - run: |
                docker build . -t ${{ secrets.ACR_REGISTRY }}/${{env.APPSERVICE_NAME}}:${{ github.sha }} -t ${{ secrets.ACR_REGISTRY }}/${{env.APPSERVICE_NAME}}:latest
                docker push ${{ secrets.ACR_REGISTRY }}/${{env.APPSERVICE_NAME}}